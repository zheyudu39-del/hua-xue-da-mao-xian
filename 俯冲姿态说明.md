# 俯冲姿态功能说明 🎿⛷️

## 功能概述

当人物从坡度较大的坡面下滑时，自动切换为俯冲姿态，呈现专业滑雪运动员的空气动力学姿态。

## 触发条件

### 坡度阈值
- **普通姿态**：坡度 ≤ 15度
- **俯冲姿态**：坡度 > 15度
- **完全俯冲**：坡度 ≥ 30度

### 俯冲强度计算
```javascript
const slopeAngleDeg = (this.slopeAngle || 0) * 180 / Math.PI;
const isSteepSlope = this.isGrounded && slopeAngleDeg > 15;
const diveAmount = isSteepSlope ? Math.min((slopeAngleDeg - 15) / 15, 1) : 0;
```

**俯冲量 (diveAmount)**：
- 15度：0.0（开始俯冲）
- 22.5度：0.5（半俯冲）
- 30度：1.0（完全俯冲）

## 姿态变化

### 1. 身体姿态 🧍

#### 身体前倾
```javascript
ctx.translate(0, -diveAmount * 3); // 重心前移（最多3px）
ctx.rotate(diveAmount * 0.15);     // 身体前倾（最多8.6度）
```

#### 效果：
- **重心前移**：0-3像素
- **身体角度**：额外前倾0-8.6度
- **视觉效果**：身体更加贴近滑雪板

### 2. 手臂姿态 💪

#### 手臂伸展
```javascript
const armSwing = jumpPose * 5 + diveAmount * 8;      // 前伸幅度
const armAngleAdjust = jumpPose * 0.3 + diveAmount * 0.5; // 角度调整
const armExtend = diveAmount * 6;                     // 伸展距离
```

#### 效果：
- **前伸幅度**：额外8像素
- **角度调整**：额外0.5弧度（约28.6度）
- **伸展距离**：0-6像素
- **视觉效果**：双臂向前完全伸展，减少风阻

### 3. 腿部姿态 🦵

#### 腿部弯曲
```javascript
const legOffset = jumpPose * 3 + diveAmount * 4;     // 前移
const legAngleAdjust = jumpPose * 0.2 + diveAmount * 0.3; // 角度
const legBend = diveAmount * 5;                       // 弯曲程度
```

#### 效果：
- **前移距离**：额外4像素
- **角度调整**：额外0.3弧度（约17.2度）
- **弯曲程度**：0-5像素
- **视觉效果**：腿部更加弯曲，降低重心

## 视觉对比

### 普通姿态（坡度 ≤ 15度）
```
    O     头部直立
   /|\    手臂自然摆动
   / \    腿部直立
  =====   滑雪板
```

### 半俯冲姿态（坡度 22.5度）
```
   O      头部前倾
  /|--    手臂半伸展
  /\      腿部微弯
 =====    滑雪板
```

### 完全俯冲姿态（坡度 ≥ 30度）
```
  O       头部完全前倾
 /|----   手臂完全伸展
 /\       腿部深蹲
=====     滑雪板
```

## 技术实现

### 坡度检测
```javascript
// 在Panda.update()中
const slope = terrain.getSlopeAt(this.x + this.width / 2);
this.slopeAngle = Math.atan(slope); // 弧度
```

### 姿态调整
```javascript
// 在drawPandaBody()中
const slopeAngleDeg = (this.slopeAngle || 0) * 180 / Math.PI;
const isSteepSlope = this.isGrounded && slopeAngleDeg > 15;
const diveAmount = isSteepSlope ? Math.min((slopeAngleDeg - 15) / 15, 1) : 0;
```

### 渐进过渡
- 俯冲量从0到1平滑过渡
- 所有姿态调整都基于`diveAmount`
- 确保动作流畅自然

## 游戏体验

### 速度感增强
- 俯冲姿态视觉上更快
- 配合陡坡的高速度
- 增加刺激感

### 真实感提升
- 模拟真实滑雪运动员
- 空气动力学姿态
- 专业竞速感觉

### 策略性
- 陡坡时自动俯冲
- 平地时恢复正常
- 适应地形变化

## 参数调整

### 可调参数
```javascript
// 坡度阈值
const DIVE_THRESHOLD = 15; // 开始俯冲的坡度

// 俯冲强度
const BODY_LEAN = 0.15;    // 身体前倾角度
const BODY_SHIFT = 3;      // 重心前移距离
const ARM_EXTEND = 8;      // 手臂伸展幅度
const LEG_BEND = 5;        // 腿部弯曲程度
```

### 调整建议
- **更激进**：增大所有参数值
- **更保守**：减小所有参数值
- **更早俯冲**：降低`DIVE_THRESHOLD`
- **更晚俯冲**：提高`DIVE_THRESHOLD`

## 动画效果

### 过渡平滑
- 所有变化都是渐进的
- 基于`diveAmount`线性插值
- 无突兀的姿态切换

### 组合效果
- 身体 + 手臂 + 腿部同步变化
- 整体协调一致
- 符合物理规律

## 未来扩展

可能的增强功能：
- [ ] 俯冲时速度加成
- [ ] 俯冲姿态音效
- [ ] 风声效果
- [ ] 速度线特效
- [ ] 俯冲计时器
- [ ] 俯冲距离统计
